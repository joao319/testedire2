!function(){function e(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function t(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}function a(e,t){if(e){if("string"==typeof e)return i(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(a):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?i(e,t):void 0}}function s(e,i){return function(e){if(Array.isArray(e))return e}(e)||t(e)||a(e,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var n=window,o=function(){"use strict";function t(){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),!n.MissiveChatConfig||!n.MissiveChatConfig.id)return console.warn("Invalid Missive Chat configuration");this.DOMNodes={html:document.documentElement,body:document.body},this.options={domain:document.domain},this.config=this.mergeConfigs(),this.injectHTML(),this.handleMessage=this.handleMessage.bind(this),n.addEventListener("message",this.handleMessage)}var i,a,s;return i=t,a=[{key:"destroy",value:function(){var e=this.DOMNodes,t=e.body,i=e.main;t.removeChild(i),n.removeEventListener("message",this.handleMessage)}},{key:"sendMessage",value:function(e){var t=this.DOMNodes.iframe;if(t&&t.contentWindow)try{t.contentWindow.postMessage(e,"https://webchat.missiveapp.com")}catch(e){}}},{key:"handleCallback",value:function(e){var t=e.callback,i=e.data;n.MissiveChatConfig[t]&&n.MissiveChatConfig[t](i)}},{key:"load",value:function(){this.loaded||(this.loaded=!0,this.DOMNodes.main.classList.add("__loaded"),n.MissiveChatConfig.onReady&&setTimeout((function(){n.MissiveChatConfig.onReady()}),this.options.transitionDuration))}},{key:"setUser",value:function(e){e=h(e),n.MissiveChatConfig.user=e,this.exec("reset",{user:e})}},{key:"getMeta",value:function(){var e={href:location.href.replace(/\/$/,""),user_agent:navigator.userAgent,language:(navigator.language||navigator.userLanguage||"").split("-")[0].toLowerCase()};return n.MissiveChatConfig.meta&&(e.custom=n.MissiveChatConfig.meta),e}},{key:"setMeta",value:function(e){l(e)&&(n.MissiveChatConfig.meta=h(e)||void 0)}},{key:"addMeta",value:function(e){if(l(e))for(var t in n.MissiveChatConfig.meta||(n.MissiveChatConfig.meta={}),e)n.MissiveChatConfig.meta[t]=e[t]}},{key:"setVariables",value:function(e){if(l(e)){for(var t in e)n.MissiveChatConfig.chat.variables[t]=e[t],this.config.chat.variables[t]=e[t];this.injectDynamicStyles({reset:!0}),this.exec("handleUpdate",{config:this.config})}}},{key:"mergeConfigs",value:function(e){var t=d({},r,e,n.MissiveChatConfig);return(t.support.email||t.support.phone)&&(Array.isArray(t.messages.error)||(t.messages.error=[t.messages.error]),t.messages.error.push(["You can also",t.support.email?"send us an email at ".concat(t.support.email):"",t.support.email&&t.support.phone?"or":"",t.support.phone?"reach out by phone at {{ tel:".concat(t.support.phone," }}"):""].join(" ").trim())),t}},{key:"handleServerConfig",value:function(e){this.config=this.mergeConfigs(e),this.injectDynamicStyles(),this.exec("handleUpdate",{config:this.config,options:this.options})}},{key:"exec",value:function(e,t){this.sendMessage({event:"missive-webchat-exec",data:{method:e,params:t}})}},{key:"open",value:function(){var e=this;this.options.opened=!0;var t=this.DOMNodes,i=t.html,a=t.main;t.wrapper,t.iframe,a.classList.remove("__closed"),a.classList.add("__opened"),a.onclick=null;var s=[n.innerWidth,n.innerHeight].sort((function(e,t){return e-t}));s[0]<=500&&s[1]<=926?(e.pageXOffset=n.pageXOffset,e.pageYOffset=n.pageYOffset,a.setAttribute("data-fullscreen",!0),setTimeout((function(){i.classList.add("missive-chat-fullscreen")}),e.options.transitionDuration+100)):(e.pageXOffset=void 0,e.pageYOffset=void 0),n.MissiveChatConfig.onOpen&&n.MissiveChatConfig.onOpen()}},{key:"close",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).silent,t=this;this.options.opened=!1;var i=this.DOMNodes,a=i.html,s=i.main;null!=this.pageYOffset&&(a.classList.remove("missive-chat-fullscreen"),n.scrollTo(this.pageXOffset,this.pageYOffset)),s.classList.add("__closed"),s.classList.remove("__opened"),s.removeAttribute("data-fullscreen"),s.onclick=function(){t.exec("open")},e||n.MissiveChatConfig.onClose&&n.MissiveChatConfig.onClose()}},{key:"showButton",value:function(){this.options.hidden=!1,this.DOMNodes.main.classList.remove("__hidden"),this.exec("handleUpdate",{options:this.options})}},{key:"hideButton",value:function(){this.options.hidden=!0,this.DOMNodes.main.classList.add("__hidden"),this.exec("handleUpdate",{options:this.options})}},{key:"setBadge",value:function(e){var t=this.DOMNodes.badge;e?(t.innerHTML=e,t.classList.add("__visible"),this.showNewMessageTitle(e)):(t.classList.remove("__visible"),this.clearNewMessageTitle())}},{key:"clearNewMessageTitle",value:function(){clearInterval(this.newMessageTitleInterval),null!=this.originalTitle&&(document.title=this.originalTitle||"")}},{key:"showNewMessageTitle",value:function(e){var t=this;null==this.originalTitle&&(this.originalTitle=document.title);var i=function(){document.title="(".concat(e,") ").concat(e>1?t.config.messages.newMessages:t.config.messages.newMessage)};this.clearNewMessageTitle(),i();var a=!1;this.newMessageTitleInterval=setInterval((function(){a?i():document.title=t.originalTitle||"",a=!a}),1e3)}},{key:"handleMessage",value:function(e){if(e.source!=window){var t=e.data,i=t.messageId,a=t.event,s=t.data;switch(a){case"missive-webchat-init":this.sendMessage({event:"missive-webchat-init",data:{config:this.config,options:this.options}});break;case"missive-webchat-close":this.close();break;case"missive-webchat-open":this.open();break;case"missive-webchat-destroy":this.destroy();break;case"missive-webchat-loaded":this.load();break;case"missive-webchat-badge":this.setBadge(s);break;case"missive-webchat-config":this.handleServerConfig(s);break;case"missive-webchat-callback":this.handleCallback(s);break;case"missive-webchat-meta":var n=this.getMeta();this.sendMessage({messageId:i,data:n})}}}},{key:"injectHTML",value:function(){var e=this.DOMNodes,t=e.html,i=e.body,a=document.createElement("div");a.setAttribute("id","missive-webchat");var s=document.createElement("div");s.setAttribute("id","missive-webchat-wrapper");var n=document.createElement("div");n.setAttribute("id","missive-webchat-badge");var o=document.createElement("iframe");o.setAttribute("id","missive-webchat-iframe"),o.setAttribute("title",this.config.messages.title),o.setAttribute("allowTransparency","true"),o.setAttribute("frameBorder","0"),o.setAttribute("src","https://webchat.missiveapp.com/".concat(this.config.id,"/webchat"));var r=document.createElement("style");r.type="text/css",r.innerHTML=c([["html.missive-chat-fullscreen, html.missive-chat-fullscreen > body",["position: static","overflow: hidden"]],["html.missive-chat-fullscreen > body",["height: 0","margin: 0"]],["#missive-webchat, #missive-webchat *",["-webkit-tap-highlight-color: rgba(0,0,0, 0)"]],["#missive-webchat",["opacity: 0","pointer-events: none","position: fixed","max-width: calc(100% - 40px)","max-height: calc(100% - 40px)","min-width: 0","min-height: 0","display: block","box-sizing: content-box","margin: 0","padding: 0","width: 62px","height: 62px","transform: scale(0) rotate(-20deg)","z-index: 2147483001"]],['#missive-webchat[data-position="top-right"]',["bottom: auto","left: auto"]],['#missive-webchat[data-position="top-right"][data-fullscreen]',["top: 0","right: 0","bottom: auto","left: auto"]],['#missive-webchat[data-position="top-left"]',["bottom: auto","right: auto"]],['#missive-webchat[data-position="top-left"][data-fullscreen]',["top: 0","left: 0","bottom: auto","right: auto"]],['#missive-webchat[data-position="bottom-left"]',["top: auto","right: auto"]],['#missive-webchat[data-position="bottom-left"][data-fullscreen]',["bottom: 0","left: 0","top: auto","right: auto"]],["#missive-webchat.__loaded",["opacity: 1","transform: scale(1) rotate(0)","pointer-events: auto"]],["#missive-webchat.__closed",["cursor: pointer"]],["#missive-webchat.__closed.__hidden",["transform: scale(0)"]],["#missive-webchat.__closed:active",["transform: scale(.92)"]],["#missive-webchat.__closed #missive-webchat-iframe",["pointer-events: none"]],["#missive-webchat[data-fullscreen].__opened",["width: 100%","height: 100%","max-width: none","max-height: none","bottom: 0","right: 0"]],["#missive-webchat[data-fullscreen].__opened #missive-webchat-wrapper",["border: 0","border-radius: 0"]],["#missive-webchat-wrapper",["overflow: hidden","position: absolute","width: 100%","height: 100%","min-width: 100%","max-width: 100%","min-height: 100%","max-height: 100%","top: 0","left: 0","margin: 0","padding: 0","display: block","border-radius: 30px","box-sizing: border-box","background: transparent"]],["#missive-webchat-badge",["position: absolute",'font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif',"text-align: center","top: -6px","right: -6px","width: 24px","height: 24px","line-height: 24px","font-size: 14px","transform: scale(0)"]],["#missive-webchat-badge.__visible",["transform: scale(1)"]],["#missive-webchat-iframe",["height: 100%","width: 100%","min-width: 100%","max-width: 100%","min-height: 100%","max-height: 100%","background-color: transparent"]]]),s.appendChild(o),a.appendChild(s),a.appendChild(n),a.appendChild(r),this.DOMNodes={html:t,body:i,main:a,wrapper:s,badge:n,iframe:o},this.close({silent:!0}),i.appendChild(a)}},{key:"injectDynamicStyles",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).reset,t=this.DOMNodes.main;if(e&&this.DOMNodes.dynamicStyle&&(t.removeChild(this.DOMNodes.dynamicStyle),delete this.DOMNodes.dynamicStyle),!this.DOMNodes.dynamicStyle){t.setAttribute("data-position",this.config.chat.position),this.config.chat.hidden&&this.hideButton();var i=this.getCSSVariable("transition-duration"),a=parseFloat(i)||0;-1==i.indexOf("ms")&&(a*=1e3),this.options.transitionDuration=a;var s=document.createElement("style");s.type="text/css",s.innerHTML=c([["#missive-webchat",["bottom: ".concat(this.getCSSVariable("margin-bottom","margin")),"bottom: calc(".concat(this.getCSSVariable("margin-bottom","margin")," + env(safe-area-inset-bottom))"),"right: ".concat(this.getCSSVariable("margin-right","margin")),"transition-property: transform, opacity, width, height","transition-duration: ".concat(this.getCSSVariable("transition-duration")),"transition-timing-function: ".concat(this.getCSSVariable("transition-easing"))]],["#missive-webchat.__hidden",["transform-origin: ".concat(this.config.chat.position.replace("-"," "))]],['#missive-webchat[data-position="top-right"]',["top: ".concat(this.getCSSVariable("margin-top","margin")),"right: ".concat(this.getCSSVariable("margin-right","margin"))]],['#missive-webchat[data-position="top-left"]',["top: ".concat(this.getCSSVariable("margin-top","margin")),"left: ".concat(this.getCSSVariable("margin-left","margin"))]],['#missive-webchat[data-position="bottom-left"]',["bottom: ".concat(this.getCSSVariable("margin-bottom","margin")),"bottom: calc(".concat(this.getCSSVariable("margin-bottom","margin")," + env(safe-area-inset-bottom))"),"left: ".concat(this.getCSSVariable("margin-left","margin"))]],["#missive-webchat.__opened",["width: ".concat(this.getCSSVariable("width")),"height: ".concat(this.getCSSVariable("height")),"max-height: ".concat(this.getCSSVariable("max-height")),"max-width: ".concat(this.getCSSVariable("max-width"))]],["#missive-webchat.__opened #missive-webchat-wrapper",["border-radius: ".concat(this.getCSSVariable("opened-border-radius"))]],["#missive-webchat-wrapper",["border: ".concat(this.getCSSVariable("border")),"border-radius: ".concat(this.getCSSVariable("closed-border-radius")),"box-shadow: ".concat(this.getCSSVariable("box-shadow")),"transition: all ".concat(this.getCSSVariable("transition-duration")," ").concat(this.getCSSVariable("transition-easing"))]],["#missive-webchat-badge",["color: ".concat(this.getCSSVariable("badge-color")),"background-color: ".concat(this.getCSSVariable("badge-background-color")),"border-radius: ".concat(this.getCSSVariable("badge-border-radius")),"box-shadow: ".concat(this.getCSSVariable("badge-box-shadow")),"transition: all ".concat(this.getCSSVariable("transition-duration")," ").concat(this.getCSSVariable("transition-easing"))]]]),this.DOMNodes.dynamicStyle=s,t.appendChild(s)}}},{key:"getCSSVariable",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];var a=!0,s=!1,n=void 0;try{for(var o,r=t[Symbol.iterator]();!(a=(o=r.next()).done);a=!0){var c=o.value,h=this.config.chat.variables[c];if(h)return h}}catch(e){s=!0,n=e}finally{try{a||null==r.return||r.return()}finally{if(s)throw n}}}}],a&&e(i.prototype,a),s&&e(i,s),t}(),r={chat:{position:"bottom-right",hidden:!1,hideWhenOffline:!1,hideBranding:!1,showOnlineStatus:!0,showAvatars:!0,showNames:!0,variables:{"background-color":"#fff","badge-background-color":"#f23131","badge-border-radius":"100%","badge-box-shadow":"0 1px 2px rgba(0,0,0, .2)","badge-color":"#fff","badge-size":"24px","border-color":"rgba(0,0,0, .05)",border:"solid 1px rgba(0,0,0, .06)","box-shadow":"0 5px 30px rgba(0,0,0, .1)","bubble-dark-color":"var(--main-color)","bubble-light-color":"#f5f5f5","close-button-color":"#fff","closed-border-radius":"30px","font-family":'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',"font-size":"15px","header-opened-background-color":"var(--main-color)","header-subtitle-text-color":"rgba(255,255,255, .65)","header-title-text-color":"#fff",height:"600px","light-text-color":"#7b7c7f","main-color":"#2866D1",margin:"20px","max-height":"calc(100% - 40px)","max-width":"calc(100% - 40px)","opened-border-radius":"10px","status-connecting-color":"#fdd157","status-offline-color":"#f23131","status-online-color":"#00b351","text-color":"#34363a","transition-duration":"225ms","transition-easing":"cubic-bezier(.4, .0, .2, 1)",width:"350px"}},support:{},user:{},visitor:{askName:!0,requireName:!1,askEmail:!0,requireEmail:!0,requireConsent:!1},messages:{welcome:"Hi there! 👋\n\nThe team will reply as soon as possible.",help:"How can we help?",title:"Chat with us",online:"We’re online",offline:"We’re offline",connecting:"Connecting…",chat:"Message…",newMessage:"New message!",newMessages:"New messages!",error:"Sorry, there is an issue connecting to our chat. Please check your Internet connection and try again.",internet:"Can’t send messages offline.",identify:"First, identify yourself.",identifyName:"Name",identifyEmail:"Email",identifySubmit:"Submit",identifySkip:"Skip",identifyRequired:"Required field",identifyThanks:"Thanks",identifyConsent:"I accept this website privacy policy and terms of use."}},c=function(e){return e.map((function(e){var t=s(e,2),i=t[0],a=t[1];return"".concat(i," { ").concat(a?a.concat("").join(" !important; "):"","}")})).join("\n")},h=function(e){return JSON.parse(JSON.stringify(e))},l=function(e){return"object"==typeof e&&!Array.isArray(e)},d=function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),a=1;a<t;a++)i[a-1]=arguments[a];var s=!0,n=!1,o=void 0;try{for(var r,c=i[Symbol.iterator]();!(s=(r=c.next()).done);s=!0){var m=r.value,g=null;try{g=h(m)}catch(e){continue}for(var u in g){var f=g[u];l(f)&&u in e?d(e[u],f):e[u]=f}}}catch(e){n=!0,o=e}finally{try{s||null==c.return||c.return()}finally{if(n)throw o}}return e};!function(){if(n.MissiveChat={open:function(){this.instance&&this.instance.exec("open")},close:function(){this.instance&&this.instance.exec("close")},showButton:function(){this.instance&&this.instance.showButton()},hideButton:function(){this.instance&&this.instance.hideButton()},setUser:function(e){this.instance&&this.instance.setUser(e)},setMeta:function(e){this.instance&&this.instance.setMeta(e)},addMeta:function(e){this.instance&&this.instance.addMeta(e)},setVariables:function(e){this.instance&&this.instance.setVariables(e)}},n.MissiveChat.show=n.MissiveChat.showButton,n.MissiveChat.hide=n.MissiveChat.hideButton,!("Intl"in window)&&!("classList"in Element.prototype))return console.warn("Missive Chat isn’t compatible with this browser.");var e=function(){n.MissiveChat.instance&&n.MissiveChat.instance.destroy(),n.MissiveChat.instance=new o};window.addEventListener("page:update",e),"loading"==document.readyState?document.addEventListener("DOMContentLoaded",e):e()}()}();
//# sourceMappingURL=missive.js.map
